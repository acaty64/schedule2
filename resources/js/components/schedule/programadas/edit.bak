<template>
  <div class="container">
    <div class="row">
      <div class="col-md-4"><b>Edición de Vacaciones programadas por rango de fechas</b></div>
      <div class="col-md-1">
        <button v-if='panel_btn == "view"' v-on:click='btnEdit()' class="btn btn-sm btn-success">Editar</button>
        <button v-if='panel_btn == "edit" || panel_btn == "add"' v-on:click='btnAdd()' class="btn btn-sm btn-danger">Grabar</button>
      </div>
      <div class="col-md-1">
        <button v-if='panel_btn == "view"' v-on:click='btnAdd()' class="btn btn-sm btn-primary">Agregar</button>
        <button v-if='panel_btn == "edit" || panel_btn == "add"' v-on:click='btnAdd()' class="btn btn-sm btn-primary">Escape</button>
      </div>
    </div>
    <span v-if='panel_btn == "view" || panel_btn == "edit"'>
      <div class="row" v-for="rango in programadas">
<!--         <div class="col-md-2">
          <b>{{ rango.periodo }}</b><br>
          <font color="red"><b>{{ rango.message }}</b></font>
        </div> -->
        <div class="col-md-2">
          Del: 
          <span v-if="panel_data == 'view'">
            {{ wdia(rango.fecha_ini) }}
          </span>
          <span v-if="panel_data == 'edit'">
            <datepicker 
                v-model="rango.fecha_ini" 
                type="date" 
                @closed="changeProgramadas(rango)" 
                zone="local" 
                value-zone="local" 
                :language="es"></datepicker>
          </span>
        </div> 
        <div class="col-md-2">
          <span v-if="panel_data == 'view'">
            Cantidad de días: {{ rango.dias }}
          </span>
          <span v-if="panel_data == 'edit'">
            Cantidad de días: <input v-model="rango.dias" @change="changeProgramadas(rango)">
          </span>
        </div>
        <div class="col-md-2">
          Al: 
          <span v-if="panel_data == 'view'">
            {{ wdia(rango.fecha_fin) }}
          </span>
          <span v-if="panel_data == 'edit'">
            <br> {{ wdia(rango.fecha_fin) }}
          </span>
        </div>
      </div><!-- END v-for="rango in  vacaciones.programadas" !-->
    </span>
    <span v-if='panel_btn == "add"'>
panel para agregar
    </span>
  </div>
</template>

<script>
  import { mapState } from 'vuex';
  import { mapGetters } from 'vuex'
  import Datepicker from 'vuejs-datepicker';
  import {es} from 'vuejs-datepicker/dist/locale';

  export default {
    mounted() {
      // console.log('ProgramadasComponent.vue mounted'); 
      this.setDate(); 
    },
    name: 'Programadas',
    props: ['programadas'],
    components: {
      Datepicker,
    },
    data () {
      var hoy = new Date().setHours(0,0,0,0);
      return {
        es: es,
        new: {
          fecha_ini: Date(hoy), 
          fecha_fin: Date(hoy),
        }
      }
    },
    computed: {
      ...mapState({
        // es: (state) =>state.es,
        // programadas: (state) => state.programadas,
        panel_btn: (state) => state.panel.btn.programadas,
        panel_data: (state) => state.panel.data.programadas,
        porDiaWeek: (state) => state.porDiaWeek,
      }),
      ...mapGetters([
        'wdia', 'dfecha'
      ]),
    },
    methods: {
      setDate(){
        for ( var i in this.programadas ) {
          this.programadas[i]['fecha_ini'] = this.dfecha(this.programadas[i]['fecha_ini']);
        }
      },
      async changeProgramadas(item){
        await this.$store.dispatch('consistencia', ['programadas', item]);
        await this.$store.dispatch('changeProgramadas', item);
        this.$store.dispatch('calculoVacaciones');
      },
      btnAdd(){
        this.$store.commit('btnAdd', 'programadas');
      },
      btnEdit (){
        this.$store.commit('btnEdit','programadas');
      },

    }, // End of Methods
  };  
</script>

